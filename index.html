<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Airtable Connection Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <h1 class="text-3xl font-bold mb-4">Airtable Connection Test</h1>
    <div id="status-container">
        <p class="text-lg">Testing connection...</p>
    </div>
    <div id="output-container" class="mt-4 space-y-4"></div>

<script>
    const airtableConfig = {
        apiKey: 'patA8WihRZtwXarV8.d6d00c7b162757fb1b30efe56d8b58f8dbbbbb9f058e52a22fcde00e566b9956',
        baseId: 'appOKqcWBsHytL5Ae',
    };
    const BASE_URL = `https://api.airtable.com/v0/${airtableConfig.baseId}/`;

    async function testFetch(tableName) {
        const outputContainer = document.getElementById('output-container');
        try {
            const response = await fetch(`${BASE_URL}${encodeURIComponent(tableName)}`, {
                headers: { 'Authorization': `Bearer ${airtableConfig.apiKey}` }
            });
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();
            
            const resultDiv = document.createElement('div');
            resultDiv.className = 'p-4 bg-green-100 border border-green-300 rounded';
            resultDiv.innerHTML = `
                <h2 class="font-bold text-green-800">SUCCESS: Loaded ${data.records.length} records from "${tableName}"</h2>
                <pre class="mt-2 text-xs bg-white p-2 rounded overflow-auto">${JSON.stringify(data.records.slice(0, 2), null, 2)}</pre>
            `;
            outputContainer.appendChild(resultDiv);
            return true;
        } catch (error) {
            console.error(`Error fetching ${tableName}:`, error);
            const resultDiv = document.createElement('div');
            resultDiv.className = 'p-4 bg-red-100 border border-red-300 rounded';
            resultDiv.innerHTML = `<h2 class="font-bold text-red-800">FAILED: Could not load data from "${tableName}"</h2><p class="text-sm mt-1">Please double-check the table name is an exact, case-sensitive match and that your API key has access to this table.</p>`;
            outputContainer.appendChild(resultDiv);
            return false;
        }
    }

    async function runTest() {
        const statusContainer = document.getElementById('status-container');
        statusContainer.innerHTML = ''; // Clear initial message

        // The three tables your app needs to function
        const tablesToTest = [
            'Machines',
            'BSV 100 Consumables',
            'BSV Maintenance Logs'
        ];

        await Promise.all(tablesToTest.map(table => testFetch(table)));
    }

    document.addEventListener('DOMContentLoaded', runTest);
</script>
</body>
</html>
